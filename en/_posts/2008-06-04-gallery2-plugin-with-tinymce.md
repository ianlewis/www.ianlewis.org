---
layout: post
title: "Gallery2 plugin with TinyMCE"
date: 2008-06-04 18:18:21 +0000
permalink: /en/gallery2-plugin-with-tinymce
blog: en
render_with_liquid: false
---

<p>I made some changes to the <a href="http://manual.b2evolution.net/Plugins/tinymce_plugin">TinyMCE plugin</a> for <a href="http://www.b2evolution.net/" title="b2evolution">b2evolution</a> to support some callbacks which will allow other <a href="http://www.b2evolution.net/" title="b2evolution">b2evolution</a> plugins to register TinyMCE plugins automatically. This is especially useful for the <a href="http://manual.b2evolution.net/Plugins/gallery2_plugin">Gallery2 plugin</a> because it will allow me to add a button that allows users to add photos from Gallery2 to their blog posts to TinyMCE automatically when the Gallery2 plugin is installed.  Currently <a href="http://manual.b2evolution.net/Plugins/gallery2_plugin#Using_the_Gallery2_Plugin_with_the_TinyMCE_Plugin">it's a pain to get it to work</a> because the standard gallery2 image chooser button doesn't work with TinyMCE and installing it requires you to copy the g2image directory to another location.</p>

<p>Fortunately these sorts of callbacks are implemented in the <a href="http://www.b2evolution.net/" title="b2evolution">b2evolution</a> <a href="http://doc.b2evolution.net/v-2-4/plugins/Plugin.html">Plugin API</a> already. I just needed to specify that the TinyMCE plugin has some extra callbacks and then fire the associated events at the right time. The code is a bit awkward but it serves it's purpose.</p>

<p>The first part is specifying the extra events.</p>

<div class="codeblock amc_php amc_short"><table><tr class="amc_code_odd"><td class="amc_line"><div class="amc1"></div></td><td><span style="color: #000000; font-weight: bold;">function</span> GetExtraEvents<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span><br /></td></tr><tr class="amc_code_even"><td class="amc_line"><div class="amc2"></div></td><td><span style="color: #66cc66;">&#123;</span><br /></td></tr><tr class="amc_code_odd"><td class="amc_line"><div class="amc3"></div></td><td>&nbsp; &nbsp; <span style="color: #b1b100;">return</span> <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><br /></td></tr><tr class="amc_code_even"><td class="amc_line"><div class="amc4"></div></td><td>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;tinymce_before_init&quot;</span> <span style="color: #66cc66;">=&gt;</span> <span style="color: #ff0000;">&quot;Event that is called before tinymce is initialized&quot;</span><span style="color: #66cc66;">,</span><br /></td></tr><tr class="amc_code_odd"><td class="amc_line"><div class="amc5"></div></td><td>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;tinymce_extend_plugins&quot;</span> <span style="color: #66cc66;">=&gt;</span> <span style="color: #ff0000;">&quot;Event called to allow other plugins to extend the plugin list&quot;</span><span style="color: #66cc66;">,</span><br /></td></tr><tr class="amc_code_even"><td class="amc_line"><div class="amc6"></div></td><td>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #ff0000;">&quot;tinymce_extend_buttons&quot;</span> <span style="color: #66cc66;">=&gt;</span> <span style="color: #ff0000;">&quot;Event called to allow other plugins to extend the button list&quot;</span><br /></td></tr><tr class="amc_code_odd"><td class="amc_line"><div class="amc7"></div></td><td>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span><br /></td></tr><tr class="amc_code_even"><td class="amc_line"><div class="amc8"></div></td><td><span style="color: #66cc66;">&#125;</span></td></tr></table></div>

<p>Then I fire the events like so. The &apos;tinymce_extend_plugins&apos; and &apos;tinymce_extend_buttons&apos; events allow other plugins to modify the plugins list and buttons list via a special &quot;get_trigger_event&quot; call.</p>

<div class="codeblock amc_php amc_short"><table><tr class="amc_code_odd"><td class="amc_line"><div class="amc1"></div></td><td><span style="color: blue;">$tmce_plugins_array</span> <span style="color: #66cc66;">=</span><br /></td></tr><tr class="amc_code_even"><td class="amc_line"><div class="amc2"></div></td><td>&nbsp; &nbsp; <span style="color: blue;">$Plugins</span><span style="color: #66cc66;">-&gt;</span><span style="color: #006600;">get_trigger_event</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;tinymce_extend_plugins&quot;</span><span style="color: #66cc66;">,</span><br /></td></tr><tr class="amc_code_odd"><td class="amc_line"><div class="amc3"></div></td><td>&nbsp; &nbsp; &nbsp; &nbsp; <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">&quot;tinymce_plugins&quot;</span> <span style="color: #66cc66;">=&gt;</span> <span style="color: blue;">$tmce_plugins_array</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span><br /></td></tr><tr class="amc_code_even"><td class="amc_line"><div class="amc4"></div></td><td>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff0000;">&quot;tinymce_plugins&quot;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></td></tr></table></div>

<p>The plugins list is modified on the Gallery2 plugin side by adding an implementation of the event hook. In this case the &apos;tinymce_plugins&apos; key in the $params array is a reference that can be modified and passed back to the TinyMCE plugin.</p>

<div class="codeblock amc_php amc_short"><table><tr class="amc_code_odd"><td class="amc_line"><div class="amc1"></div></td><td><span style="color: #000000; font-weight: bold;">function</span> tinymce_extend_plugins<span style="color: #66cc66;">&#40;</span> <span style="color: #66cc66;">&amp;</span><span style="color: blue;">$params</span> <span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span><br /></td></tr><tr class="amc_code_even"><td class="amc_line"><div class="amc2"></div></td><td>&nbsp; &nbsp; <a href="http://www.php.net/array_push"><span style="color: #000066;">array_push</span></a><span style="color: #66cc66;">&#40;</span><span style="color: blue;">$params</span><span style="color: #66cc66;">&#91;</span><span style="color: #ff0000;">&quot;tinymce_plugins&quot;</span><span style="color: #66cc66;">&#93;</span><span style="color: #66cc66;">,</span> <span style="color: #ff0000;">&quot;-g2image&quot;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span><br /></td></tr><tr class="amc_code_odd"><td class="amc_line"><div class="amc3"></div></td><td><span style="color: #66cc66;">&#125;</span></td></tr></table></div>

<p>You can view the changes made in the checked in code <a href="http://evocms-plugins.svn.sourceforge.net/viewvc/evocms-plugins?view=rev&amp;revision=714">here</a>.</p>
